const { readFileSync, writeFileSync } = require('fs');

const loadUsers = () => JSON.parse(readFileSync('./users.json', 'utf8'));
const loadColors = () => JSON.parse(readFileSync('./colors.json', 'utf8'));
const { clients: allClients } = require('./clients.json');
const { colors: colorNames, argb: rgbValues } = require('./data.js');

const task_01 = () => {
    const userList = loadUsers();
    
    const southUsers = userList
        .filter(item => Number(item.address.geo.lat) < 0)
        .map(item => ({ 
            login: item.username, 
            location: item.address.city 
        }))
        .sort((x, y) => y.location.localeCompare(x.location));
    
    return JSON.stringify(southUsers, null, 2);
};

const task_02 = () => {
    const cityClients = allClients
        .filter(person => person.address.city === "Кунгур")
        .sort((first, second) => {
            const sexOrder = { 
                'женский': 1, 
                'female': 1, 
                'famale': 1, 
                'male': 2, 
                'мужской': 2 
            };
            
            const firstSex = sexOrder[first.gender] || 999;
            const secondSex = sexOrder[second.gender] || 999;
            
            if (firstSex !== secondSex) return firstSex - secondSex;
            if (second.age !== first.age) return second.age - first.age;
            return first.name.localeCompare(second.name, 'ru');
        });
    
    return JSON.stringify(cityClients, null, 2);
};

const task_03 = () => {
    const colorInfo = loadColors();
    
    const shortNames = colorInfo
        .map(entry => Object.getOwnPropertyNames(entry)[0])
        .filter(name => name.length < 6)
        .sort((a, b) => a.localeCompare(b));
    
    return JSON.stringify(shortNames, null, 2);
};

const task_04 = () => {
    const colorEntries = loadColors();
    
    const formattedColors = colorEntries
        .map(entry => {
            const colorKey = Object.keys(entry)[0];
            return {
                name: colorKey,
                rgb_code: entry[colorKey].slice(0, 3)
            };
        })
        .sort((colorA, colorB) => colorA.name.localeCompare(colorB.name));
    
    return JSON.stringify(formattedColors, null, 2);
};

const task_05 = () => {
    try {
        const convertRGB = (red, green, blue) => {
            const hexParts = [red, green, blue]
                .map(value => value.toString(16).padStart(2, '0'));
            return `#${hexParts.join('')}`.toLowerCase();
        };
        
        const hexColors = colorNames
            .map((name, index) => ({
                color_name: name,
                hex_value: convertRGB(...rgbValues[index].slice(0, 3))
            }))
            .sort((a, b) => a.color_name.localeCompare(b.color_name));
        
        const outputPath = 'hexColors.json';
        writeFileSync(outputPath, JSON.stringify(hexColors, null, 2));
        
        return `Файл ${outputPath} создан успешно`;
    } catch (error) {
        return `Произошла ошибка: ${error}`;
    }
};


console.log(task_05());
